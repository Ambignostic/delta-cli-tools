#!/usr/bin/env php
<?php

require __DIR__ . '/../vendor/autoload.php';

use DeltaCli\Project;
use DeltaCli\Exception\ConsoleOutputInterface;
use Symfony\Component\Console\Application;
use Symfony\Component\Console\Output\ConsoleOutput;

try {
    $output      = new ConsoleOutput();
    $application = new Application();
    $project     = Project::fromConfigFile();

    $application->setCatchExceptions(false);
    $application->setName($project->getName());
    $application->addCommands($project->getScripts());
    $application->run(null, $output);
} catch (Exception $e) {
    $output->writeln('<error>' . get_class($e) . '</error>');

    if ($e instanceof ConsoleOutputInterface) {
        $e->outputToConsole($output);
    } else {
        $output->writeln($e->getMessage());
    }
}
